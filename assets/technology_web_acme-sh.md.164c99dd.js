import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.d2dbc4f9.js";const F=JSON.parse('{"title":"泛域名证书申请以及部署","description":"","frontmatter":{"categories":["工具分享"],"tags":["Linux","运维"]},"headers":[],"relativePath":"technology/web/acme-sh.md","filePath":"technology/web/acme-sh.md","lastUpdated":1696675092000}'),p={name:"technology/web/acme-sh.md"},o=l(`<h1 id="泛域名证书申请以及部署" tabindex="-1">泛域名证书申请以及部署 <a class="header-anchor" href="#泛域名证书申请以及部署" aria-label="Permalink to &quot;泛域名证书申请以及部署&quot;">​</a></h1><blockquote><p>由于目前所有的域名服务商对于免费CA证书仅提供由<code>digicert</code>机构颁发的，只允许有20个子域名且不支持泛子域名。故使用 <code>Let&#39;s Encrypt</code> 的SSL证书</p></blockquote><p>Let’s Encrypt 是一个证书颁发机构，向 Let’s Encrypt 申请证书是免费的。Let&#39;s Encrypt 支持泛域名证书，不需要为每个子域名单独申请证书。</p><h2 id="一、acme-sh部署工具" tabindex="-1">一、<code>acme.sh</code>部署工具 <a class="header-anchor" href="#一、acme-sh部署工具" aria-label="Permalink to &quot;一、\`acme.sh\`部署工具&quot;">​</a></h2><p>根据 <code>acme.sh</code> [中文说明](<a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E" target="_blank" rel="noreferrer">说明 · acmesh-official/acme.sh Wiki (github.com)</a>)，<code>acme.sh</code> 实现了 <code>acme</code> 协议, 可以从 <code>let‘s encrypt</code> 生成免费的证书。</p><ol><li><p>其安装只需要执行以下命令，所有用户均可安装：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://get.acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">email=my@example.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://get.acme.sh</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">email=my@example.com</span></span></code></pre></div></li><li><p>该工具将会安装在 <code>~/.acme.sh/</code> 目录下。</p></li></ol><h2 id="二、生成证书" tabindex="-1">二、生成证书 <a class="header-anchor" href="#二、生成证书" aria-label="Permalink to &quot;二、生成证书&quot;">​</a></h2><p><code>acme.sh</code> 实现了 <strong><code>acme</code></strong> 协议支持的所有验证协议. 一般有两种方式验证: http 和 dns 验证.</p><h3 id="_2-1-http-方式" tabindex="-1">2.1 http 方式 <a class="header-anchor" href="#_2-1-http-方式" aria-label="Permalink to &quot;2.1 http 方式&quot;">​</a></h3><p>http方式需要在该网站根目录放置一个文件来验证域名所有权。</p><p>可以执行以下命令生成：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--issue</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mydomain.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www.mydomain.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--webroot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/wwwroot/mydomain.com/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--issue</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mydomain.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www.mydomain.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--webroot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/wwwroot/mydomain.com/</span></span></code></pre></div><p>如果你使用apache或者nginx服务，执行以下命令会自动识别并完成验证，完成后还将为你删除文件，做到用户无感验证。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--issue</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mydomain.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--apache/nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--issue</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mydomain.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--apache/nginx</span></span></code></pre></div><p>如果你的服务器80端口是空闲的，<code>acme.sh</code>还将自动配置一个webserver，监听80端口并自动完成配置。</p><h3 id="_2-2-dns-方式" tabindex="-1">2.2 DNS 方式 <a class="header-anchor" href="#_2-2-dns-方式" aria-label="Permalink to &quot;2.2 DNS 方式&quot;">​</a></h3><p>DNS方式只需要在配置DNS解析记录即可，且TXT的解析记录对你的服务不会产生影响。</p><p>执行以下命令，按照提示配置DNS解析记录即可：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--issue</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dns</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mydomain.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--issue</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dns</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mydomain.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre></div><p>解析完成后，执行以下命令来完成验证并重新生成证书：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--renew</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mydomain.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--renew</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mydomain.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span></span></code></pre></div><blockquote><p>注意：若没有配置Automatic DNS API，该方法将无法自动更新你的域名证书。</p></blockquote><h3 id="_2-3-dns进阶版" tabindex="-1">2.3 DNS进阶版 <a class="header-anchor" href="#_2-3-dns进阶版" aria-label="Permalink to &quot;2.3 DNS进阶版&quot;">​</a></h3><p>DNS方式还支持使用域名解析商提供的接口自动进行配置。以阿里云为例：</p><p>首先将阿里云的阿里云 API 的密钥以以下格式配置到环境变量：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 腾讯云dnspod</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> DP_Id</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> DP_Key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 阿里云</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> Ali_Key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> Ali_Secret</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;XXXXXXXXXX“</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 腾讯云dnspod</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> DP_Id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> DP_Key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 阿里云</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> Ali_Key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;XXXXXXXXXX&quot;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> Ali_Secret</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;XXXXXXXXXX“</span></span></code></pre></div><p>然后就可以通过以下命令生成证书：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 腾讯云</span></span>
<span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--issue</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns_dp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 阿里云</span></span>
<span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--issue</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns_ali</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.example.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 腾讯云</span></span>
<span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--issue</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns_dp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 阿里云</span></span>
<span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--issue</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns_ali</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.example.com</span></span></code></pre></div><h2 id="三、安装配置证书" tabindex="-1">三、安装配置证书 <a class="header-anchor" href="#三、安装配置证书" aria-label="Permalink to &quot;三、安装配置证书&quot;">​</a></h2><p>此处以Podman Nginx容器配置证书举例。</p><h3 id="_3-1-生成nginx配置" tabindex="-1">3.1 生成Nginx配置 <a class="header-anchor" href="#_3-1-生成nginx配置" aria-label="Permalink to &quot;3.1 生成Nginx配置&quot;">​</a></h3><p>NGINX配置文件可以使用[NGINXCONF.IO](<a href="https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN" target="_blank" rel="noreferrer">NGINXConfig | DigitalOcean</a>)配置。页面为中文且较为友好。</p><h3 id="_3-2-生成-dhparam-pem" tabindex="-1">3.2 生成 dhparam.pem <a class="header-anchor" href="#_3-2-生成-dhparam-pem" aria-label="Permalink to &quot;3.2 生成 dhparam.pem&quot;">​</a></h3><p>openssl dhparam用于生成和管理dh文件。dh(Diffie-Hellman)是著名的密钥交换协议，或称为密钥协商协议，它可以保证通信双方安全地交换密钥。但注意，它不是加密算法，所以不提供加密功能，仅仅只是保护密钥交换的过程。在openvpn中就使用了该交换协议。</p><p>执行以下命令即可生成：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">openssl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dhparam</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">~/dhparam.pem</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dhparam</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">~/dhparam.pem</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span></code></pre></div><p>如果你使用上面提供的NGINXCONFIG.IO生成了配置文件，此处配置在nginx.conf文件中：</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Diffie-Hellman parameter for DHE ciphersuites                                         </span></span>
<span class="line"><span style="color:#E1E4E8;">ssl_dhparam /etc/nginx/dhparam.pem</span><span style="color:#6A737D;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Diffie-Hellman parameter for DHE ciphersuites                                         </span></span>
<span class="line"><span style="color:#24292E;">ssl_dhparam /etc/nginx/dhparam.pem</span><span style="color:#6A737D;">;</span></span></code></pre></div><h3 id="_3-3-自动更新证书" tabindex="-1">3.3 自动更新证书 <a class="header-anchor" href="#_3-3-自动更新证书" aria-label="Permalink to &quot;3.3 自动更新证书&quot;">​</a></h3><p>以下为podman Nginx容器自动更新证书的命令：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">/.acme.sh/acme.sh --install-cert </span><span style="color:#79B8FF;">\\ </span></span>
<span class="line"><span style="color:#B392F0;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example.com</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\ </span></span>
<span class="line"><span style="color:#B392F0;">--key-file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/ssl/example.com.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\ </span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">私钥地址</span></span>
<span class="line"><span style="color:#B392F0;">--fullchain-file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/ssl/example.com.cer</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">\\ </span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">公钥地址</span></span>
<span class="line"><span style="color:#B392F0;">--reloadcmd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;podman exec -it nginx nginx force-reload&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">~</span><span style="color:#24292E;">/.acme.sh/acme.sh --install-cert </span><span style="color:#005CC5;">\\ </span></span>
<span class="line"><span style="color:#6F42C1;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example.com</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\ </span></span>
<span class="line"><span style="color:#6F42C1;">--key-file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/ssl/example.com.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\ </span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">私钥地址</span></span>
<span class="line"><span style="color:#6F42C1;">--fullchain-file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/ssl/example.com.cer</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">\\ </span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">公钥地址</span></span>
<span class="line"><span style="color:#6F42C1;">--reloadcmd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;podman exec -it nginx nginx force-reload&quot;</span></span></code></pre></div><blockquote><p>注意：<code>nginx reload</code> 命令并不会更新证书，需要使用 <code>nginx force-reload</code></p></blockquote><h2 id="四、查看已安装证书信息" tabindex="-1">四、查看已安装证书信息 <a class="header-anchor" href="#四、查看已安装证书信息" aria-label="Permalink to &quot;四、查看已安装证书信息&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--info</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example.com</span></span>
<span class="line"><span style="color:#6A737D;"># 会输出如下内容：</span></span>
<span class="line"><span style="color:#E1E4E8;">DOMAIN_CONF</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/root/.acme.sh/example.com/example.com.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_Domain</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">example.com</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_Alt</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">no</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_Webroot</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">dns_ali</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_PreHook</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_PostHook</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_RenewHook</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_API</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://acme-v02.api.letsencrypt.org/directory</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_Keylength</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_OrderFinalize</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://acme-v02.api.letsencrypt.org/acme/finalize/23xxxx150/781xxxx4310</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_LinkOrder</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://acme-v02.api.letsencrypt.org/acme/order/233xxx150/781xxxx4310</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_LinkCert</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://acme-v02.api.letsencrypt.org/acme/cert/04cbd28xxxxxx349ecaea8d07</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_CertCreateTime</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1649358725</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_CertCreateTimeStr</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Thu</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Apr</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#9ECBFF;">:12:05</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UTC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2022</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_NextRenewTimeStr</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Mon</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#9ECBFF;">:12:05</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UTC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2022</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_NextRenewTime</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1654456325</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_RealCertPath</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_RealCACertPath</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_RealKeyPath</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/etc/acme/example.com/privkey.pem</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_ReloadCmd</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">force-reload</span></span>
<span class="line"><span style="color:#E1E4E8;">Le_RealFullChainPath</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/etc/acme/example.com/chain.pem</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--info</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example.com</span></span>
<span class="line"><span style="color:#6A737D;"># 会输出如下内容：</span></span>
<span class="line"><span style="color:#24292E;">DOMAIN_CONF</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/root/.acme.sh/example.com/example.com.conf</span></span>
<span class="line"><span style="color:#24292E;">Le_Domain</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">example.com</span></span>
<span class="line"><span style="color:#24292E;">Le_Alt</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">no</span></span>
<span class="line"><span style="color:#24292E;">Le_Webroot</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">dns_ali</span></span>
<span class="line"><span style="color:#24292E;">Le_PreHook</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_PostHook</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_RenewHook</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_API</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://acme-v02.api.letsencrypt.org/directory</span></span>
<span class="line"><span style="color:#24292E;">Le_Keylength</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_OrderFinalize</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://acme-v02.api.letsencrypt.org/acme/finalize/23xxxx150/781xxxx4310</span></span>
<span class="line"><span style="color:#24292E;">Le_LinkOrder</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://acme-v02.api.letsencrypt.org/acme/order/233xxx150/781xxxx4310</span></span>
<span class="line"><span style="color:#24292E;">Le_LinkCert</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://acme-v02.api.letsencrypt.org/acme/cert/04cbd28xxxxxx349ecaea8d07</span></span>
<span class="line"><span style="color:#24292E;">Le_CertCreateTime</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1649358725</span></span>
<span class="line"><span style="color:#24292E;">Le_CertCreateTimeStr</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Thu</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Apr</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">:12:05</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UTC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2022</span></span>
<span class="line"><span style="color:#24292E;">Le_NextRenewTimeStr</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Mon</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">:12:05</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UTC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2022</span></span>
<span class="line"><span style="color:#24292E;">Le_NextRenewTime</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1654456325</span></span>
<span class="line"><span style="color:#24292E;">Le_RealCertPath</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_RealCACertPath</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">Le_RealKeyPath</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/etc/acme/example.com/privkey.pem</span></span>
<span class="line"><span style="color:#24292E;">Le_ReloadCmd</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">force-reload</span></span>
<span class="line"><span style="color:#24292E;">Le_RealFullChainPath</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/etc/acme/example.com/chain.pem</span></span></code></pre></div><h2 id="五、更新证书" tabindex="-1">五、更新证书 <a class="header-anchor" href="#五、更新证书" aria-label="Permalink to &quot;五、更新证书&quot;">​</a></h2><p>目前证书在 60 天以后会自动更新，使用crontab 工具。无需任何操作。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">crontab</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-l</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">56</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/root/.acme.sh&quot;/acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cron</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--home</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/root/.acme.sh&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/null</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">crontab</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-l</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">56</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/root/.acme.sh&quot;/acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cron</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--home</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/root/.acme.sh&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/null</span></span></code></pre></div><h2 id="六、修改reloadcmd" tabindex="-1">六、修改ReloadCmd <a class="header-anchor" href="#六、修改reloadcmd" aria-label="Permalink to &quot;六、修改ReloadCmd&quot;">​</a></h2><p>根据官网的说法，不建议直接修改<code>example.conf</code>文件来达到修改ReloadCmd的目的，且目前修改<code>ReloadCmd</code>没有专门的命令，可以通过重新安装证书来修改。</p><h2 id="七、更新-acme-sh" tabindex="-1">七、更新 acme.sh <a class="header-anchor" href="#七、更新-acme-sh" aria-label="Permalink to &quot;七、更新 acme.sh&quot;">​</a></h2><p>升级 acme.sh 到最新版 :</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--upgrade</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--upgrade</span></span></code></pre></div><p>如果你不想手动升级, 可以开启自动升级:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--auto-upgrade</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--upgrade</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--auto-upgrade</span></span></code></pre></div><p>之后, acme.sh 就会自动保持更新了.</p><p>你也可以随时关闭自动更新:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">acme.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--auto-upgrade</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">acme.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--upgrade</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--auto-upgrade</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span></code></pre></div><h2 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-label="Permalink to &quot;参考链接&quot;">​</a></h2><ul><li><p><a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E" target="_blank" rel="noreferrer">acme.sh中文文档 (github.com)</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/445852299" target="_blank" rel="noreferrer">Let&#39;s Encrypt SSL 泛域名证书申请和配置 - 知乎 (zhihu.com)</a></p></li><li><p><a href="https://github.com/acmesh-official/acme.sh/issues/1439" target="_blank" rel="noreferrer">acme.sh · Issue #1439 · (github.com)</a></p></li><li><p><a href="https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN" target="_blank" rel="noreferrer">NGINXConfig | DigitalOcean</a></p></li><li><p><a href="https://www.cnblogs.com/f-ck-need-u/p/7103791.html" target="_blank" rel="noreferrer">openssl dhparam(密钥交换) - 骏马金龙 - 博客园 (cnblogs.com)</a></p></li></ul>`,59),e=[o];function c(t,r,y,i,E,d){return a(),n("div",null,e)}const m=s(p,[["render",c]]);export{F as __pageData,m as default};
